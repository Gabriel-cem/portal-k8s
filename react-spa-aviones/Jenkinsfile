podTemplate(
  containers: [
    containerTemplate(
      name: 'kaniko',
      image: 'gcr.io/kaniko-project/executor:latest',
      ttyEnabled: true,
      volumeMounts: [
        mountPath: '/kaniko/.docker/', 
        name: 'kaniko-secret'
      ]
    )
  ],
  volumes: [
    secretVolume(secretName: 'dockerhub-kaniko2', mountPath: '/kaniko/.docker/')
  ]
) {
  node(POD_LABEL) {
    stage('Build and Push Image with Kaniko') {
      container('kaniko') {
        sh '''
          /kaniko/executor \
            --dockerfile=react-spa-aviones/Dockerfile \
            --context=dir://react-spa-aviones \
            --destination=gab741/portal-aviones:tag \
            --cache
        '''
      }
    }
  }
}
